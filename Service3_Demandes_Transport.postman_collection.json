{
  "info": {
    "name": "Service 3 - Demandes de Transport (Complete)",
    "_postman_id": "service3-demandes-transport-complete",
    "description": "Collection Postman compl√®te pour tester le Service 3 : Demandes de Transport\n\n## üìö Documentation API\nCe service dispose de plusieurs fa√ßons d'acc√©der √† la documentation :\n- **/** - Documentation JSON personnalis√©e avec exemples de test\n- **/swagger-ui.html** - Interface Swagger UI interactive (ouvrir dans navigateur)\n- **/v3/api-docs** - Sp√©cification OpenAPI 3.0 standard\n\n## Instructions\n1. Le token JWT de test est d√©j√† configur√© et valide jusqu'en 2030\n2. Consultez la section üìö API Documentation pour acc√©der aux docs sans authentification\n3. Lancez 'Health Check' pour v√©rifier que le service fonctionne\n4. Cr√©ez une demande avec 'Cr√©er une Demande'\n5. Copiez l'ID de la demande cr√©√©e (automatiquement sauvegard√© dans 'demande_id')\n6. Testez les autres endpoints\n\n## Endpoints Principaux\n- POST /api/v1/demandes - Cr√©er une demande\n- GET /api/v1/demandes - Lister mes demandes\n- GET /api/v1/demandes/{id} - Voir une demande\n- PUT /api/v1/demandes/{id}/validation - Valider une demande\n- PUT /api/v1/demandes/{id}/paiement - Webhook paiement (sans auth)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://172.30.80.11:31029",
      "type": "string"
    },
    {
      "key": "jwt_token",
      "value": "eyJhbGciOiJIUzM4NCJ9.eyJyb2xlIjoiQ0xJRU5UIiwidXNlcklkIjoxLCJzdWIiOiIxIiwiaWF0IjoxNzY0MTA4NjQ4LCJleHAiOjE3OTU2NDQ2NDh9.MsAIo8mq0sGFYTZ5XNK8oHU-fcQhZNCRWIJ_CxTtB2sau88MBHz4JiO6-DhhqHnl",
      "type": "string",
      "description": "Token JWT valide pour 1 an - userId=1, role=ROLE_CLIENT"
    },
    {
      "key": "demande_id",
      "value": "1",
      "type": "string",
      "description": "ID de la demande √† utiliser pour les tests"
    }
  ],
  "item": [
    {
      "name": "üìö API Documentation",
      "item": [
        {
          "name": "Custom JSON Documentation (Root)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/",
              "host": ["{{baseUrl}}"],
              "path": [""]
            },
            "description": "Acc√®de √† la documentation API personnalis√©e en format JSON avec exemples de test pour PowerShell, cURL et Fetch. **Pas d'authentification requise**"
          },
          "response": []
        },
        {
          "name": "OpenAPI 3.0 Specification",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/v3/api-docs",
              "host": ["{{baseUrl}}"],
              "path": ["v3", "api-docs"]
            },
            "description": "R√©cup√®re la sp√©cification OpenAPI 3.0 compl√®te en JSON. Utile pour importer dans des outils comme Postman ou g√©n√©rer des SDKs client. **Pas d'authentification requise**"
          },
          "response": []
        },
        {
          "name": "Swagger UI URL",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/swagger-ui.html",
              "host": ["{{baseUrl}}"],
              "path": ["swagger-ui.html"]
            },
            "description": "Ouvre l'interface Swagger UI interactive dans votre navigateur. Permet de tester les endpoints directement depuis le navigateur web. **Pas d'authentification requise**\n\nNote: Ouvrez cette URL dans un navigateur pour voir l'interface compl√®te."
          },
          "response": []
        }
      ],
      "description": "Endpoints de documentation API - Tous accessibles sans authentification"
    },
    {
      "name": "üè• Health & Status",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/actuator/health",
              "host": ["{{baseUrl}}"],
              "path": ["actuator", "health"]
            },
            "description": "V√©rifie que l'application est op√©rationnelle"
          },
          "response": []
        },
        {
          "name": "Liveness Probe",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/actuator/health/liveness",
              "host": ["{{baseUrl}}"],
              "path": ["actuator", "health", "liveness"]
            },
            "description": "Probe Kubernetes pour v√©rifier si l'application est vivante"
          },
          "response": []
        },
        {
          "name": "Readiness Probe",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/actuator/health/readiness",
              "host": ["{{baseUrl}}"],
              "path": ["actuator", "health", "readiness"]
            },
            "description": "Probe Kubernetes pour v√©rifier si l'application est pr√™te"
          },
          "response": []
        },
        {
          "name": "Metrics",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/actuator/metrics",
              "host": ["{{baseUrl}}"],
              "path": ["actuator", "metrics"]
            },
            "description": "Liste toutes les m√©triques disponibles"
          },
          "response": []
        },
        {
          "name": "Info",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/actuator/info",
              "host": ["{{baseUrl}}"],
              "path": ["actuator", "info"]
            },
            "description": "Informations sur l'application"
          },
          "response": []
        }
      ],
      "description": "Endpoints de sant√© et monitoring (pas besoin de JWT)"
    },
    {
      "name": "üì¶ Demandes CRUD",
      "item": [
        {
          "name": "1. Cr√©er une Demande",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('demande_id', jsonData.id);",
                  "    console.log('Demande cr√©√©e avec ID: ' + jsonData.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"volume\": 15.5,\n  \"natureMarchandise\": \"Meubles de salon\",\n  \"dateDepart\": \"2025-12-15T10:00:00\",\n  \"adresseDepart\": \"123 Rue Mohammed V, Casablanca\",\n  \"adresseDestination\": \"456 Avenue Hassan II, Rabat\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/demandes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "demandes"]
            },
            "description": "Cr√©e une nouvelle demande de transport. L'ID de la demande cr√©√©e est automatiquement sauvegard√© dans la variable 'demande_id'."
          },
          "response": []
        },
        {
          "name": "2. Lister mes Demandes",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/demandes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "demandes"]
            },
            "description": "R√©cup√®re toutes les demandes du client authentifi√©"
          },
          "response": []
        },
        {
          "name": "3. Voir une Demande par ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/demandes/{{demande_id}}",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "demandes", "{{demande_id}}"]
            },
            "description": "R√©cup√®re les d√©tails d'une demande sp√©cifique"
          },
          "response": []
        },
        {
          "name": "4. Valider une Demande (Accepter le devis)",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/demandes/{{demande_id}}/validation",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "demandes", "{{demande_id}}", "validation"]
            },
            "description": "Le client valide sa demande et accepte le devis propos√©"
          },
          "response": []
        }
      ],
      "description": "Op√©rations CRUD sur les demandes (n√©cessite JWT)"
    },
    {
      "name": "üîÑ Webhooks (Internes)",
      "item": [
        {
          "name": "Webhook - Paiement Effectu√©",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nouveauStatut\": \"PAYEE\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/demandes/{{demande_id}}/paiement",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "demandes", "{{demande_id}}", "paiement"]
            },
            "description": "Webhook appel√© par le Service Paiements pour indiquer qu'une demande a √©t√© pay√©e"
          },
          "response": []
        },
        {
          "name": "Webhook - Paiement √âchou√©",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nouveauStatut\": \"ECHEC\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/demandes/{{demande_id}}/paiement",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "demandes", "{{demande_id}}", "paiement"]
            },
            "description": "Webhook pour simuler un paiement √©chou√©"
          },
          "response": []
        },
        {
          "name": "Webhook - Paiement en Attente",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nouveauStatut\": \"EN_ATTENTE\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/demandes/{{demande_id}}/paiement",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "demandes", "{{demande_id}}", "paiement"]
            },
            "description": "Webhook pour indiquer que le paiement est en attente"
          },
          "response": []
        }
      ],
      "description": "Endpoints webhooks appel√©s par d'autres services (pas besoin de JWT)"
    },
    {
      "name": "üìù Exemples de Demandes",
      "item": [
        {
          "name": "Demande - Transport de Meubles",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('demande_id', jsonData.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"volume\": 20.0,\n  \"natureMarchandise\": \"Meubles - Canap√©, table basse et armoire\",\n  \"dateDepart\": \"2025-12-20T09:00:00\",\n  \"adresseDepart\": \"45 Boulevard Mohammed V, Casablanca, 20000\",\n  \"adresseDestination\": \"12 Avenue Allal Ben Abdellah, Rabat, 10000\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/demandes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "demandes"]
            },
            "description": "Exemple: Transport de meubles de Casablanca √† Rabat"
          },
          "response": []
        },
        {
          "name": "Demande - √âlectrom√©nager",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('demande_id', jsonData.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"volume\": 8.5,\n  \"natureMarchandise\": \"√âlectrom√©nager - R√©frig√©rateur et machine √† laver\",\n  \"dateDepart\": \"2025-12-18T14:00:00\",\n  \"adresseDepart\": \"30 Rue Ibn Batouta, Marrakech, 40000\",\n  \"adresseDestination\": \"5 Avenue Hassan II, Agadir, 80000\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/demandes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "demandes"]
            },
            "description": "Exemple: Transport d'√©lectrom√©nager de Marrakech √† Agadir"
          },
          "response": []
        },
        {
          "name": "Demande - Mat√©riaux de Construction",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('demande_id', jsonData.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"volume\": 35.0,\n  \"natureMarchandise\": \"Mat√©riaux de construction - Briques, ciment et fer\",\n  \"dateDepart\": \"2025-12-22T08:00:00\",\n  \"adresseDepart\": \"Zone Industrielle Ain Sebaa, Casablanca, 20000\",\n  \"adresseDestination\": \"Chantier Hay Riad, Rabat, 10000\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/demandes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "demandes"]
            },
            "description": "Exemple: Transport de mat√©riaux de construction"
          },
          "response": []
        },
        {
          "name": "Demande - Produits Alimentaires",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('demande_id', jsonData.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"volume\": 12.0,\n  \"natureMarchandise\": \"Produits alimentaires - Fruits et l√©gumes frais\",\n  \"dateDepart\": \"2025-12-16T06:00:00\",\n  \"adresseDepart\": \"March√© de Gros, Kenitra, 14000\",\n  \"adresseDestination\": \"Supermarch√© Central, Tanger, 90000\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/demandes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "demandes"]
            },
            "description": "Exemple: Transport de produits alimentaires de Kenitra √† Tanger"
          },
          "response": []
        },
        {
          "name": "Demande - √âquipements Informatiques",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    var jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('demande_id', jsonData.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"volume\": 5.0,\n  \"natureMarchandise\": \"√âquipements informatiques - Serveurs et ordinateurs\",\n  \"dateDepart\": \"2025-12-17T11:00:00\",\n  \"adresseDepart\": \"Technopark, Casablanca, 20000\",\n  \"adresseDestination\": \"Universit√© Al Akhawayn, Ifrane, 53000\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/api/v1/demandes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "demandes"]
            },
            "description": "Exemple: Transport d'√©quipements informatiques fragiles"
          },
          "response": []
        }
      ],
      "description": "Exemples de diff√©rents types de demandes de transport"
    },
    {
      "name": "üîí Tests de S√©curit√©",
      "item": [
        {
          "name": "Test - Sans Token (doit √©chouer)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/api/v1/demandes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "demandes"]
            },
            "description": "Test sans token JWT - doit retourner 403 Forbidden"
          },
          "response": []
        },
        {
          "name": "Test - Token Invalide (doit √©chouer)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer invalid_token_here",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/demandes",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "demandes"]
            },
            "description": "Test avec un token invalide - doit retourner 403 Forbidden"
          },
          "response": []
        }
      ],
      "description": "Tests pour v√©rifier que la s√©curit√© fonctionne correctement"
    }
  ]
}
